<div class="view-loans-container">
  <h2 class="page-title">Ongoing Loans</h2>

  <div class="loans-grid" *ngIf="loans && loans.length > 0; else noLoans">
    <div class="loan-card" *ngFor="let loan of loans; trackBy: trackByLoanId" [ngClass]="{'editing': loan.isEditing}">

      <!-- Header -->
      <div class="loan-header">
        <h4 *ngIf="!loan.isEditing">{{ loan.borrowerName }}</h4>
        <input *ngIf="loan.isEditing" [(ngModel)]="loan.borrowerName" placeholder="Borrower Name" />
        <button class="delete-btn" (click)="deleteLoan(loan)" title="Delete Loan">
          <i class="bi bi-trash-fill"></i> delete
        </button>
      </div>

      <!-- Loan Info -->
      <div class="loan-info" *ngIf="!loan.isEditing">
        <p><span>Loan ID:</span> {{ loan.loanId }}</p>
        <p><span>Total Principal:</span> ₹{{ loan.principalAMT | number }}</p>
        <p><span>Total Amount:</span> ₹{{ loan.totalAmount | number }}</p>
        <p><span>Start Date:</span> {{ loan.startDate | date:'dd MMM yyyy' }}</p>
        <p><span>End Date:</span> {{ loan.endDate | date:'dd MMM yyyy' }}</p>
      </div>

      <!-- Edit Form -->
      <div class="loan-edit" *ngIf="loan.isEditing">
        <label>Principal (₹):</label>
        <input type="number" [(ngModel)]="loan.principalAMT" />
        <label>Interest (%):</label>
        <input type="number" [(ngModel)]="loan.int" />
        <label>End Date:</label>
        <input type="date" [(ngModel)]="loan.endDate" />
        <label>Borrower Contact:</label>
        <input type="text" [(ngModel)]="loan.borrowerContact" />
        <label>Security Asset:</label>
        <input type="text" [(ngModel)]="loan.securityAsset" />
        <label>Investor:</label>
        <input type="text" [(ngModel)]="loan.investor" />
        <label>Investor %:</label>
        <input type="number" [(ngModel)]="loan.investorPercentage" />
        <label>Total Tenure (months):</label>
        <input type="number" [(ngModel)]="loan.totalTenure" />
      </div>

      <!-- Action Buttons -->
      <div *ngIf="!loan.isEditing">
        <button class="view-more-btn" (click)="toggleDetails(loan)">
          {{ loan.showDetails ? 'Hide Details' : 'View More' }}
        </button>
        <button class="view-more-btn" (click)="editLoan(loan)">Edit</button>
      </div>

      <div *ngIf="loan.isEditing">
        <button class="view-more-btn save" (click)="saveLoan(loan)">Save</button>
        <button class="view-more-btn cancel" (click)="cancelEdit(loan)">Cancel</button>
      </div>

      <!-- Loan Details -->
      <div class="loan-details" *ngIf="loan.showDetails && !loan.isEditing">
        <hr />
        <p><span>Loan ID:</span> {{ loan.loanId }}</p>
        <p><span>Borrower Contact:</span> {{ loan.borrowerContact }}</p>
        <p><span>Security Asset:</span> {{ loan.securityAsset || 'N/A' }}</p>
        <p><span>Interest %:</span> {{ loan.int }}%</p>
        <p><span>Investor:</span> {{ loan.investor || 'N/A' }}</p>
        <p><span>Investor %:</span> {{ loan.investorPercentage || 'N/A' }}%</p>
        <p><span>Total Tenure:</span> {{ loan.totalTenure || 'N/A' }} months</p>
      </div>

    </div>
  </div>

  <ng-template #noLoans>
    <p class="no-loans-text">No ongoing loans found.</p>
  </ng-template>
</div>

<nav class="bottom-nav">
  <a routerLink="/home" class="nav-btn">
    <i class="bi bi-house-door-fill"></i>
    <span>Home</span>
  </a>
  <a routerLink="/add-loan-forms" class="nav-btn">
    <i class="bi bi-plus-circle-fill"></i>
    <span>Add Loan</span>
  </a>
  <a routerLink="/more-Actions" class="nav-btn">
    <i class="bi bi-grid-fill"></i>
    <span>More</span>
  </a>
</nav>
